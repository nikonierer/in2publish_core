<html xmlns:f="http://typo3.org/ns/TYPO3/CMS/Fluid/ViewHelpers"
	  xmlns:be="http://typo3.org/ns/TYPO3/CMS/Backend/ViewHelpers"
	  data-namespace-typo3-fluid="true"
>
	<f:layout name="Default"/>

	<f:section name="HeaderNavigationRight">
		<f:comment>Disable default pagePath and pageInfo.</f:comment>
	</f:section>

	<f:section name="Main">
		<f:render section="filter" arguments="{_all}" />
		<f:be.widget.paginate objects="{redirects}" as="paginatedRedirects" configuration="{ itemsPerPage: 20, insertAbove: 1, insertBelow: 1, recordsLabel: 'Redirects'}">
			<f:form action="publish">
				<table class="table">
					<thead>
						<tr>
							<th><f:translate key="redirect.record.id" /></th>
							<th><f:translate key="redirect.record.domain" /></th>
							<th><f:translate key="redirect.record.source" /></th>
							<th><f:translate key="redirect.record.target" /></th>
							<th><f:translate key="redirect.record.status" /></th>
							<th><f:translate key="redirect.record.actions" /></th>
						</tr>
					</thead>
					<tbody>
						<f:for each="{paginatedRedirects}" as="redirect">
							<tr>
								<td>{redirect.uid}</td>
								<td>{redirect.sourceHost}</td>
								<td>{redirect.sourcePath}</td>
								<td>{redirect.target}</td>
								<td>
									<f:switch expression="{redirect.publishingState}">
										<f:case value="publishable">
											<span title="{f:render(partial: 'Redirect/DirtyProperties', arguments: _all)}">
												<core:icon identifier="actions-code-fork" size="small"/>
											</span>
										</f:case>
										<f:case value="siteRequired">
											<span title="{f:translate(key:'redirect.status.missing_page_or_site')}">
												<core:icon identifier="apps-pagetree-page" overlay="overlay-missing" size="small"/>
											</span>
										</f:case>
										<f:case value="requiresPagePublishing">
											<span title="{f:translate(key:'redirect.status.page_not_published', arguments:'{0: redirect.pageUid, 1: redirect.pageTitle}')}">
												<core:icon identifier="apps-pagetree-page" overlay="overlay-warning" size="small"/>
											</span>
										</f:case>
										<f:case value="unchanged">
											<span title="{f:translate(key:'redirect.status.published')}">
												<core:icon identifier="actions-check" size="small"/>
											</span>
										</f:case>
									</f:switch>
								</td>
								<td>
									<f:if condition="!{redirect.deleted}">
										<be:link.editRecord class="btn btn-default" table="sys_redirect" uid="{redirect.uid}" title="{f:translate(key: 'LLL:EXT:core/Resources/Private/Language/locallang_mod_web_list.xlf:edit')}">
											<core:icon identifier="actions-open"/>
										</be:link.editRecord>
									</f:if>
									<f:switch expression="{redirect.publishingState}">
										<f:case value="publishable">
											<div class="btn-group">
												<label class="btn btn-default btn-checkbox">
													<f:form.checkbox title="Select for bulk publishing" value="{redirect.uid}" style="margin: 0" name="redirects[]"/>
													<f:variable name="viewPublishAll" value="1"/>
													<span class="t3-icon fa"></span>
												</label>
												<f:link.action action="publish" class="btn btn-default" arguments="{redirects: {0: redirect}}" title="Publish">
													<core:icon identifier="actions-caret-right" size="small"/>
												</f:link.action>
											</div>
										</f:case>
										<f:case value="siteRequired">
											<f:link.action action="selectSite" class="btn btn-default" arguments="{redirect: redirect}" title="Publish with site association">
												<core:icon identifier="actions-caret-right" overlay="overlay-external-link" size="small"/>
											</f:link.action>
										</f:case>
									</f:switch>
								</td>
							</tr>
						</f:for>
					</tbody>
					<f:if condition="{viewPublishAll}">
						<tfoot>
							<tr>
								<td></td>
								<td></td>
								<td></td>
								<td></td>
								<td></td>
								<td><f:form.submit class="btn btn-default" value="{f:translate(key:'publish_all_selected')}"/></td>
							</tr>
						</tfoot>
					</f:if>
				</table>
			</f:form>
		</f:be.widget.paginate>
		<div class="row">
			<div class="col-md-6">
				<f:translate key="redirect.legend.status"/>
				<br>
				<core:icon identifier="apps-pagetree-page" overlay="overlay-missing" size="small"/>: <f:translate key="redirect.legend.status.page_or_site_required"/>
				<br>
				<core:icon identifier="apps-pagetree-page" overlay="overlay-warning" size="small"/>: <f:translate key="redirect.legend.status.page_not_published"/>
				<br>
				<core:icon identifier="actions-code-fork" size="small"/>: <f:translate key="redirect.legend.status.unpublished_changes"/>
				<br>
				<core:icon identifier="actions-check" size="small"/>: <f:translate key="redirect.legend.status.published"/>
			</div>
			<div class="col-md-6">
				<f:translate key="redirect.legend.actions"/>
				<br>
				<core:icon identifier="actions-caret-right" size="small"/>: <f:translate key="redirect.legend.actions.publish"/>
				<br>
				<core:icon identifier="actions-caret-right" overlay="overlay-external-link" size="small"/>: <f:translate key="redirect.legend.actions.associate_site_and_publish"/>
			</div>
		</div>
	</f:section>
</html>

<f:section name="filter">
	<f:form action="list"
			id="filter-redirects"
			method="post"
			enctype="multipart/form-data"
			name="filter-redirects"
			arguments="{filter:filter}"
			class="form-inline form-inline-spaced">
		<div class="form-group">
			<label for="filter-source-host">
				<f:translate key="LLL:EXT:redirects/Resources/Private/Language/locallang_module_redirect.xlf:source_host"/>
			</label>
			<f:form.select name="filter[source_host]"
						   value="{filter.source_host}"
						   id="filter-source-host"
						   options="{hosts}"
						   class="form-control input-sm"
						   optionValueField="name"
						   optionLabelField="name"
						   prependOptionLabel="{f:translate(key: 'LLL:EXT:redirects/Resources/Private/Language/locallang_module_redirect.xlf:filter.source_host.showAll')}"
						   prependOptionValue=""
			/>
		</div>
		<div class="form-group">
			<label for="filter-source-path">
				<f:translate key="LLL:EXT:redirects/Resources/Private/Language/locallang_module_redirect.xlf:source_path"/>
			</label>
			<f:form.textfield id="filter-source-path"
							  class="form-control input-sm"
							  name="filter[source_path]"
							  value="{filter.source_path}"
			/>
		</div>
		<div class="form-group">
			<label for="filter-target">
				<f:translate key="LLL:EXT:redirects/Resources/Private/Language/locallang_module_redirect.xlf:filter.destination"/>
			</label>
			<f:form.textfield id="filter-target"
							  class="form-control input-sm"
							  name="filter[target]"
							  value="{filter.target}"
			/>
		</div>
		<div class="form-group">
			<label for="filter-status-code">
				<f:translate key="LLL:EXT:redirects/Resources/Private/Language/locallang_module_redirect.xlf:filter.targetStatusCode"/>
			</label>
			<f:form.select name="filter[status_code]"
						   value="{filter.status_code}"
						   id="filter-status-code"
						   options="{statusCodes}"
						   class="form-control input-sm"
						   optionValueField="code"
						   optionLabelField="code"
						   prependOptionLabel="{f:translate(key: 'LLL:EXT:redirects/Resources/Private/Language/locallang_module_redirect.xlf:filter.source_host.showAll')}"
						   prependOptionValue=""
			/>
		</div>
<!--		TODO: filter is ignored in paginatedRedirects-->
<!--		<div class="form-group">-->
<!--			<label for="filter-publishing-state">-->
<!--				<f:translate key="redirect.record.status"/>-->
<!--			</label>-->
<!--			<f:form.select name="filter[publishing_state]"-->
<!--						   value="{filter.publishing_state}"-->
<!--						   id="filter-publishing-state"-->
<!--						   options="{publishingStates}"-->
<!--						   class="form-control input-sm"-->
<!--						   optionValueField="state"-->
<!--						   optionLabelField="label"-->
<!--						   prependOptionLabel="{f:translate(key: 'LLL:EXT:redirects/Resources/Private/Language/locallang_module_redirect.xlf:filter.source_host.showAll')}"-->
<!--						   prependOptionValue=""-->
<!--			/>-->
<!--		</div>-->
		<div class="form-group">
			<input type="submit" value="Filtern" class="btn btn-default btn-sm" />
		</div>
	</f:form>
</f:section>
